groups:
  - name: cert-exporter-alert.rules
    rules:
      - alert: X509ExporterReadErrors
        annotations:
          description: Over the last 15 minutes, this x509-certificate-exporter
            instance has experienced errors reading certificate files or querying
            the Kubernetes API. This could be caused by a misconfiguration if
            triggered when the exporter starts.
          message: Increasing read errors for x509-certificate-exporter
          severity_level: warning
        expr: delta(x509_read_errors[15m]) > 0
        for: 5m
        labels:
          severity: warning
      - alert: CertificateError
        annotations:
          description: Certificate could not be decoded {{$labels.secret_name}} in
            Kubernetes secret {{ $labels.secret_namespace }}/{{ $labels.secret_name }}
            at location {{ $labels.filepath }}.
          message: Certificate cannot be decoded
          severity_level: critical
        expr: x509_cert_error > 0
        for: 5m
        labels:
          severity: critical
      - alert: CertificateRenewal
        annotations:
          description: Certificate for {{ $labels.subject_CN }} should be renewed
            in Kubernetes secret {{ $labels.secret_namespace }} / {{ $labels.secret_name }}.
          summary: Certificate should be renewed
          severity_level: warning
        expr: ((x509_cert_not_after - time()) / 86400) < 28
        for: 15m
        labels:
          severity: warning
      - alert: CertificateExpiration
        annotations:
          description: Certificate for {{ $labels.subject_CN }} is about to expire
            in Kubernetes secret {{ $labels.secret_namespace }} / {{ $labels.secret_name }}.
          summary: Certificate is about to expire
          severity_level: critical
        expr: ((x509_cert_not_after - time()) / 86400) < 14
        for: 15m
        labels:
          severity: critical
